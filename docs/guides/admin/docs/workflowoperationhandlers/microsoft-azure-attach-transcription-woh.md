# Microsoft Azure Attach Transcription Workflow Operation

ID: `microsoft-azure-attach-transcription`

## Description

Microsoft Azure attach transcription adds the captions file generated by [microsoft-azure-start-transcription](../workflowoperationhandlers/microsoft-azure-start-transcription-woh.md) to the media package.

## Parameter Table

| Configuration         | Description                                                                                                                                                                                                                                                                                                                                                       | Required | Default | Example                                    |
|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|---------|--------------------------------------------|
| transcription-job-id  | This is filled out by the transcription service when starting the workflow.                                                                                                                                                                                                                                                                                       | yes      | NONE    | **Should always be ${transcriptionJobId}** |
| target-flavor         | The flavor of the generated transcription file.                                                                                                                                                                                                                                                                                                                   | yes      | NONE    | captions/source                            |
| target-tags           | The comma separated list of tags to add to the generated transcription file. The common caption tags* `generator-type`, `generator` and `type` are added by the service itself. You have to manually set the `lang` tag. The values are provided as [workflow properties](#workflow-properties) but you have to choose between two digit language code or locale. | no       | EMPTY   | archive,${transcriptionLocaleTag}          |
| target-element-type   | Define where to append the transcription file. Accepted values: track, attachment.                                                                                                                                                                                                                                                                                | no       | track   | track                                      |

*For conventionally used tags see the general page on [Subtitles](../configuration/subtitles.md).

## Workflow properties

This workflow operation is not intended to be started by the user. This will be done by the [Microsoft Azure Transcription Engine](../configuration/transcription.configuration/microsoftazure.md). It will also set some workflow properties listed below.

| Workflow property                  | Description                                                                                | Default        | Example        |
|------------------------------------|--------------------------------------------------------------------------------------------|----------------|----------------|
| transcriptionJobId                 | Azure transcription job ID.                                                                | Azure specific | Azure specific |
| transcriptionLocale                | The recognized transcript locale or empty.                                                 | EMPTY          | en-GB          |
| transcriptionLocaleSet             | Boolean value if locale was recognized.                                                    | false          | true           |
| transcriptionLocaleSubtypeSuffix   | Flavor suffix with recognized locale (legacy behavior).                                    | EMPTY          | +en-GB         |
| transcriptionLocaleTag             | Lang tag with recognized locale (see [Subtitles section](../configuration/subtitles.md))   | EMPTY          | lang:en-GB     |
| transcriptionLanguage              | The recognized transcript language or empty.                                               | EMPTY          | en             |
| transcriptionLanguageSet           | Boolean value if language was recognized.                                                  | false          | true           |
| transcriptionLanguageSubtypeSuffix | Flavor suffix with recognized language (legacy behavior).                                  | EMPTY          | +en            |
| transcriptionLanguageTag           | Lang tag with recognized language (see [Subtitles section](../configuration/subtitles.md)) | EMPTY          | lang:en        |

## Examples

The next operation example shows you how to attach a generated transcript to the media package for archiving. Here we used the `transcriptionLocaleTag` workflow property to set the recognized locale as language tag for the transcription. This can be replaced with `transcriptionLanguageTag` if you prefer the two digit language codes. Please note the '!' behind the variable name. It is Freemarker syntax and mean: leave it empty if not set.

```xml
<operation
  id="microsoft-azure-attach-transcription"
  fail-on-error="true"
  exception-handler-workflow="partial-error"
  description="Attach transcription from Microsoft Azure">
  <configurations>
    <!-- This is filled out by the transcription service when starting this workflow -->
    <configuration key="transcription-job-id">${transcriptionJobId}</configuration>
    <!-- Set the flavor to something the Paella player will parse -->
    <configuration key="target-flavor">captions/source</configuration>
    <configuration key="target-tags">archive, ${transcriptionLocaleTag!}</configuration>
  </configurations>
</operation>
```
